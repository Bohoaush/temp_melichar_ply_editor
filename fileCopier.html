<!DOCTYPE html>
<html>
<head>
    <title>temp melichar ply editor</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        body {
            background-color: #121212;
            color: #CCCCCC;
        }
    </style>
</head>
<body>
<div id="status-view">
</div>
<div id="button-panel">
    <a href=".."><input id="save" type="button" value="<<== Return to playlist editor <<=="></a>
    <input id="startCopy" type="button" value="COPY">
    <input id="startDelete" type="button" value="DELETE">
</div>
<hr>
<div id="acti-por">
    <div id="wantfiles">
        <textarea id="wfe" rows="40" cols="150"></textarea>
        <input id="saveWfe" type="button" value="SAVE">
    </div>
    <div id="logView">
        
    </div>
</div>
</body>
</html>

<script>
    var myUrl = (window.location.protocol + "//" + window.location.hostname + ":" + window.location.port);

    document.getElementById("wfe").value = httpGet(myUrl + "/getWantfiles");

    function updateStatus(type, msg) {
        let statusView = document.getElementById("status-view");
        let currentTime = "";
        if (msg != "") {
            currentTime = (((new Date()).toString()).split(" GMT")[0] + ": ");
        }
        if (type == "ok") {
            statusView.style.color = "green";
            statusView.style.backgroundColor = "#DDFFDD";
        } else if (type == "warn") {
            statusView.style.color = "orange";
            statusView.style.backgroundColor = "#FFFFEE";
        } else {
            statusView.style.color = "red";
            statusView.style.backgroundColor = "#FFDDDD";
        }
        statusView.innerHTML = (currentTime + msg);
    }
    
    $("#startCopy").click(function() {
        let res = httpGet(myUrl + "/copierCopy");
        console.log(res);
        if (res == "ok") {
            updateStatus("ok", "Started copying...")
        }
    });
    
    $("#startDelete").click(function() {
        let res = httpGet(myUrl + "/copierDelete");
        if (res == "ok") {
            updateStatus("ok", "Started deleting...");
        }
    });
    
    $("#saveWfe").click(function() {
        saveWantfiles();
    });
    
    document.getElementById("logView").innerHTML = httpGet(myUrl + "/copylog");
    
    document.addEventListener('keydown', function(event) {
        if (event.keyCode == 83 && event.ctrlKey) {
            saveWantfiles();
            event.preventDefault();
        }
    });
    
    function saveWantfiles() {
        let ret = httpPost(myUrl + "/pushWantfiles", document.getElementById("wfe").value);
        if (ret == document.getElementById("wfe").value) {
            updateStatus("ok", "Saved wanted-files");
        } else {
            updateStatus("err", "Failed to save wanted-files");
        }
    }
    
    function httpGet(url) {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open( "GET", url, false );
        xmlHttp.send( null );
        return xmlHttp.responseText;
    }
    
    function httpPost(url, data) {
        try {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open("POST", url, false);
            xmlHttp.send(data);
            return xmlHttp.responseText;
        } catch {
            updateStatus("err", "Communication ERROR! Last action isn't on backend.");
        }
    }
</script>
